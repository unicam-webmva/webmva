@model webmva.Models.Progetto;
 @{ ViewData["Title"] = "Edit"; 
    
 }
<div class="container">
    <h2>Modifica Progetto</h2>
    <hr />
    <div class="row panel panel-default col-md-9">
        <!--<div class="col-md-9">-->
            @{List<webmva.ViewModels.ModuliInseriti> listaModuli = ViewBag.Moduli;
                 <form asp-action="Edit">
           <!-- <div asp-validation-summary="ModelOnly" class="text-danger"></div>--> 
            <input type="hidden" asp-for="@Model.ID" />
            <input type="hidden" asp-for="@Model.Data" />
            <div class="form-group">
                <br>
                <label asp-for="@Model.Nome" class="control-label"></label>
                <input asp-for="@Model.Nome" class="form-control" />
               <!-- <span asp-validation-for="@Model.Nome" class="text-danger"></span>-->
                
                <br>
                <label asp-for="@Model.Target" class="control-label"></label>
                <input asp-for="@Model.Target" class="form-control" onfocusout="checkIP()" />
                <!--<span asp-validation-for="@Model.Target" class="text-danger"></span>-->
               <span name="TargetValidation" style="font-family: serif;font-size: 14px;color: #FF0000;"></span>
    
                
                  <br>
                  <h5><strong>Scegli il modulo</strong></h5>
                 
                <div class="panel panel-default">
                    <div class="panel-heading">
					<a href="#" data-toggle="collapse" data-target="#Nmap">Nmap</a><br>
                    </div>
                    <div class="collapse" id="Nmap">
                     <div class="panel-body ">
                            <table class="table">
                                <div class="method">
                                    <thead>
                                        <tr>
                                            <th></th>
                                             <th>
                                        Nome
                                            </th>
                                            <th>
                                        Comando
                                            </th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                </div>
                                <tbody>
                                    <tr>
                                        <td>
                                    <input type="checkbox" name="selezionaTutto1" onclick="SelezTT1()" > <label> Scegli tutti</label><br>
                                        </td>
                                    </tr>
                                    @foreach (var item in listaModuli) {
                                       
                                        
                                            if(item.Applicazione!= webmva.Models.APPLICAZIONE.NMAP){continue;}
                                             <tr>
                                                <td>
                                                    <input type="checkbox"
                                                        name="moduliSelezionati"
                                                        value="@item.ModuloID"
                                                        @(Html.Raw(item.Inserito ? "checked=\"checked\"" : "")) />
                                                        
                                                </td>
                                        <td>
                                            @Html.DisplayFor(modelItem => item.Nome)
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem => item.Comando)
                                                </td>
                                            </tr>       
                                    }
                                </tbody>
                            </table>

                        </div>
                        </div>
                      </div>
                      
    
					<div class="panel panel-default">
                    <div class="panel-heading">
					<a href="#" data-toggle="collapse" data-target="#Nessus">Nessus</a><br>
                    </div>
                    <div class="collapse" id="Nessus">
                     <div class="panel-body ">
                            <table class="table">
                                <div class="method">
                                    <thead>
                                        <tr>
                                             <th>
                                        Nome
                                            </th>
                                            <th>
                                        Comando
                                            </th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                </div>
                                <tbody>
                                    <tr>
                                        <td>
                                    <input type="checkbox" name="selezionaTutto2" onclick="SelezTT2()" > <label> Scegli tutti</label><br>
                                        </td>
                                    </tr>
                                    @foreach (var item in listaModuli) {
                                        
                                        
                                            if(item.Applicazione!= webmva.Models.APPLICAZIONE.NESSUS){continue;}
                                             
                                        <tr>
                                                <td>
                                                    <input type="checkbox"
                                                        name="moduliSelezionati"
                                                        value="@item.ModuloID"
                                                        @(Html.Raw(item.Inserito ? "checked=\"checked\"" : "")) />
                                                        
                                                </td><td>
                                        @Html.DisplayFor(modelItem => item.Nome)
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem => item.Comando)
                                                </td>
                                            </tr>       
                                    }
                                </tbody>
                            </table>

                        </div>
                        </div>
                      </div>
                      </div>
                      <div class="panel panel-default">
                    <div class="panel-heading">
					<a href="#" data-toggle="collapse" data-target="#OpenVAS">OpenVAS</a><br>
                    </div>
                    <div class="collapse" id="OpenVAS">
                     <div class="panel-body ">
                            <table class="table">
                                <div class="method">
                                    <thead>
                                        <tr>
                                             <th>
                                        Nome
                                            </th>
                                            <th>
                                        Comando
                                            </th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                </div>
                                <tbody>
                                    <tr>
                                        <td>
                                    <input type="checkbox" name="selezionaTutto3" onclick="SelezTT3()" > <label> Scegli tutti</label><br>
                                        </td>
                                    </tr>
                                    @foreach (var item in listaModuli) {
                                        
                                        var tipo = item.GetType(); 
                                            if(tipo!= typeof(webmva.Models.ModuloNMAP)){continue;}
                                             <tr>
                                                <td>
                                                    <input type="checkbox"
                                                        name="moduliSelezionati"
                                                        value="@item.ModuloID"
                                                        @(Html.Raw(item.Inserito ? "checked=\"checked\"" : "")) />
                                                        
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem => item.Nome)
                                                </td>
                                                <td>
                                                    @Html.DisplayFor(modelItem => item.Comando)
                                                </td>
                                            </tr>       
                                    }
                                </tbody>
                            </table>

                        </div>
                        </div>
                      </div>
                     
                     	
                
            
                <br>
                <div class="col-md-12">
                <label for="descrizione">Descrizione</label>
                <textarea class="form-control" id="descrizione" placeholder="descrizione del progetto" rows="5" cols="40" style="resize:none"
                    maxlength="1000" asp-for="@Model.Descrizione"></textarea>
            </div>
        

            <div class="form-group col-sm-6 "><br>
                <input type="submit" value="Salva" class="btn btn-default" /> |
                 <a asp-action="Index"> Torna alla lista</a>
                 </div>
          
                </form>
                 
                 
                 }
        
            </div>

    </div>
</div>

@section scripts{
    <script>
    function checkIP(){
     var Target = $('input[name=*Target]').val().split(".");
    console.log(Target);
    if (Target.length != 4) {
        console.log("INVALIDO: lunghezza sbagliata");
        $('input[name=Target]').val("");
        $('span[name=TargetValidation]').text('IP inserito non corretto!');
       // alert("Hai inserito un IP errato!"); 
        
        return false;
    }
    //Check Numbers
    for (var i = 0; i < 4; i++) {
        //Perform Test
        if ( Target[i] <= -1 || Target[i] > 255 || 
             isNaN(parseFloat(Target[i])) || 
             !isFinite(Target[i])  || 
             Target[i].indexOf(" ") !== -1 ) {
                 console.log("INVALIDO");
                // alert ("Hai inserito un IP errato!!");
         $('input[name=Target]').val("");
        $('span[name=TargetValidation]').text('IP inserito non corretto!');
             return false;
        }
    }
    console.log("VALIDO");
    $('span[name=TargetValidation]').text('');

    return true;
        
    };
   function SelezTT(){
      $('input[name=selezionaTutto]').change(
        function(){
            if( $('input[name=selezionaTutto]').prop('checked')){
                var modulo = $('input[name=check]').each(function(index, element){
                    $(element).prop('checked', true);
                    console.log(index);
                   
                })
               
            }
            else{
                var modulo = $('input[name=check]').each(function(index, element){
                    $(element).prop('checked', false);
  
                })
                
            }
        });
        
        
   };

$(function(){
    var tutticheck=true;
    $('input[name=check]').change(
        function(){
            var check=$('input[name=check]');
        for(i=0; i<check.length; i++){
        if(!check[i].checked) {
            tutticheck=false;
            $('input[name=selezionaTutto]').prop('checked', false); 
            break;
        } else tutticheck=true;
        if(tutticheck)
        $('input[name=selezionaTutto]').prop('checked', true);
    }
        }
    ).change();
    });
    //seleziona tutto Nmap
     function SelezTT1(){
      $('input[name=selezionaTutto1]').change(
        function(){
            if( $('input[name=selezionaTutto1]').prop('checked')){
                var modulo = $('input[id=checkNmap]').each(function(index, element){
                    $(element).prop('checked', true);
                    console.log(index);
                   
                })
               
            }
            else{
                var modulo = $('input[id=checkNmap]').each(function(index, element){
                    $(element).prop('checked', false);
  
                })
                
            }
        });
        
        
   };

$(function(){
    var tutticheck=true;
    $('input[id=checkNmap]').change(
        function(){
            var check=$('input[id=checkNmap]');
        for(i=0; i<check.length; i++){
        if(!check[i].checked) {
            tutticheck=false;
            $('input[name=selezionaTutto1]').prop('checked', false); 
            break;
        } else tutticheck=true;
        if(tutticheck)
        $('input[name=selezionaTutto1]').prop('checked', true);
    }
        }
    ).change();
    });
    //seleziona tutto Nessus
     function SelezTT2(){
      $('input[name=selezionaTutto2]').change(
        function(){
            if( $('input[name=selezionaTutto2]').prop('checked')){
                var modulo = $('input[id=checkNessus]').each(function(index, element){
                    $(element).prop('checked', true);
                    console.log(index);
                   
                })
               
            }
            else{
                var modulo = $('input[id=checkNessus]').each(function(index, element){
                    $(element).prop('checked', false);
  
                })
                
            }
        });
        
        
   };

$(function(){
    var tutticheck=true;
    $('input[id=checkNessus]').change(
        function(){
            var check=$('input[id=checkNessus]');
        for(i=0; i<check.length; i++){
        if(!check[i].checked) {
            tutticheck=false;
            $('input[name=selezionaTutto2]').prop('checked', false); 
            break;
        } else tutticheck=true;
        if(tutticheck)
        $('input[name=selezionaTutto2]').prop('checked', true);
    }
        }
    ).change();
    });
    //seleziona tutto OpenVAS
     function SelezTT3(){
      $('input[name=selezionaTutto]').change(
        function(){
            if( $('input[name=selezionaTutto]').prop('checked')){
                var modulo = $('input[id=checkOpenVAS]').each(function(index, element){
                    $(element).prop('checked', true);
                    console.log(index);
                   
                })
               
            }
            else{
                var modulo = $('input[id=checkOpenVAS]').each(function(index, element){
                    $(element).prop('checked', false);
  
                })
                
            }
        });
        
        
   };

$(function(){
    var tutticheck=true;
    $('input[id=checkOpenVAS]').change(
        function(){
            var check=$('input[id=checkOpenVAS]');
        for(i=0; i<check.length; i++){
        if(!check[i].checked) {
            tutticheck=false;
            $('input[name=selezionaTutto3]').prop('checked', false); 
            break;
        } else tutticheck=true;
        if(tutticheck)
        $('input[name=selezionaTutto3]').prop('checked', true);
    }
        }
    ).change();
    });
   </script>
}
